# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é JJK Incidents

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### Backend (95.81.121.225:4000)
- ‚úÖ –ü–æ—Ä—Ç –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ 4000
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è Vercel (`https://jjk-incidents.vercel.app`)
- ‚úÖ Socket.io –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π polling

### Frontend
- ‚úÖ –°–æ–∑–¥–∞–Ω `vercel.json` —Å rewrites –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ `config.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏
- ‚úÖ `SocketContext.tsx` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–º—É origin
- ‚úÖ `vite.config.ts` —Å proxy –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã Vite –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `package.json`

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

```bash
cd frontend
npm install
# –∏–ª–∏
yarn install
# –∏–ª–∏
pnpm install
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–∞—è Vite.

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –í –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –±—ç–∫–µ–Ω–¥
cd backend
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd frontend
npm run dev
```

–§—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `http://localhost:5173` (Vite –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫–µ–Ω–¥—É —á–µ—Ä–µ–∑ `vite.config.ts`.

### 3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Vercel

#### –ß–µ—Ä–µ–∑ Vercel CLI:
```bash
cd frontend
npm run build
vercel --prod
```

#### –ß–µ—Ä–µ–∑ GitHub:
1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
git add .
git commit -m "Migrate from Bun to Vite + setup Vercel proxy"
git push
```

2. –í Vercel Dashboard:
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - Root Directory: `frontend`
   - Framework Preset: `Vite`
   - Build Command: `npm run build` (–∏–ª–∏ `yarn build`)
   - Output Directory: `dist`
   - Install Command: `npm install` (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ 95.81.121.225
cd ~/jjk-incidents/backend
npm run dev
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üöÄ Jujutsu Incidents server running on port 4000
üìä Database initialized at: ./src/database/missions.db
üåê CORS enabled for: ...
üîå Socket.io server ready for connections
```

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```
Browser ‚Üí http://localhost:5173/api/... 
       ‚Üí Vite Proxy 
       ‚Üí http://95.81.121.225:4000/api/...
```

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω –Ω–∞ Vercel
```
Browser ‚Üí https://jjk-incidents.vercel.app/api/...
       ‚Üí Vercel Rewrites
       ‚Üí http://95.81.121.225:4000/api/...
```

**–í–∞–∂–Ω–æ:** Vercel rewrites –æ–±—Ö–æ–¥—è—Ç Mixed Content Security Policy, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å Vercel, –∞ –Ω–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞.

---

## üêõ –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
- **–ü—Ä–æ–±–ª–µ–º–∞:** Vercel –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebSocket rewrites (serverless –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
- **–†–µ—à–µ–Ω–∏–µ:** Socket.io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ–ª—å–∫–æ HTTP long-polling** —á–µ—Ä–µ–∑ `/socket.io/*` rewrite
- **–í–∞–∂–Ω–æ:** –í `SocketContext.tsx` —É–∫–∞–∑–∞–Ω `transports: ['polling']` - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!

### –û—à–∏–±–∫–∞ CORS
- **–ü—Ä–æ–±–ª–µ–º–∞:** Backend –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- **–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `backend/src/server.ts` –µ—Å—Ç—å Vercel –¥–æ–º–µ–Ω –≤ `allowedOrigins`

### 404 –Ω–∞ /api –∑–∞–ø—Ä–æ—Å–∞—Ö
- **–ü—Ä–æ–±–ª–µ–º–∞:** Vercel –Ω–µ –≤–∏–¥–∏—Ç rewrites
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `vercel.json` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ë—ç–∫–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω** –Ω–∞ `95.81.121.225:4000`
- **Vercel rewrites —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**, –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vite proxy
- **Socket.io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ HTTP long-polling** (Vercel –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebSocket rewrites)
- Polling —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è –∏–≥—Ä—ã - –∑–∞–¥–µ—Ä–∂–∫–∞ ~100-200ms –≤–º–µ—Å—Ç–æ <50ms WebSocket
- –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ WebSocket –Ω—É–∂–µ–Ω SSL –Ω–∞ –±—ç–∫–µ–Ω–¥–µ (Caddy + –¥–æ–º–µ–Ω) + –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

1. –ü–æ–ª—É—á–∏—Ç—å –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `api.jjk-incidents.ru`)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS: A-–∑–∞–ø–∏—Å—å ‚Üí `95.81.121.225`
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Caddy:
```bash
sudo apt install caddy
```

4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Caddyfile:
```
api.jjk-incidents.ru {
    reverse_proxy localhost:4000
}
```

5. –û–±–Ω–æ–≤–∏—Ç—å `frontend/src/config.ts`:
```ts
export const API_URL = 'https://api.jjk-incidents.ru';
export const WS_URL = 'https://api.jjk-incidents.ru';
```

6. –£–¥–∞–ª–∏—Ç—å `vercel.json` (–ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ HTTPS)

